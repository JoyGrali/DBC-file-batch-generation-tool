# DBC文件编辑器 v2.1

一个功能强大的Web工具，用于创建和编辑DBC（Database CAN）文件，专为多通道设备的CAN报文批量生成而设计。支持标准帧和扩展帧，提供直观的可视化界面和灵活的配置选项。

![DBC Editor](https://img.shields.io/badge/Version-2.1-blue)
![License](https://img.shields.io/badge/License-MIT-green)
![Browser](https://img.shields.io/badge/Browser-Chrome%20%7C%20Firefox%20%7C%20Safari-orange)

## 📋 目录

- [功能特性](#功能特性)
- [快速开始](#快速开始)
- [详细使用说明](#详细使用说明)
- [配置说明](#配置说明)
- [技术特性](#技术特性)
- [文件结构](#文件结构)
- [使用示例](#使用示例)
- [常见问题](#常见问题)
- [浏览器兼容性](#浏览器兼容性)
- [贡献指南](#贡献指南)
- [许可证](#许可证)

## 🚀 功能特性

### 🆕 最新更新 (v2.1)
- **统一批量配置**: 所有批量生成配置集中在一个区域，避免配置分散造成的混淆
- **多字段批量生成**: 支持选择多个字段进行批量生成，不再局限于通道编号
- **智能范围验证**: 批量生成的范围自动受字段位数限制，防止超出有效范围
- **优化界面布局**: 修复了文字遮挡问题，改善了用户体验
- **实时配置反馈**: 启用的批量字段有视觉标识，禁用字段变灰显示

### 🎯 核心功能

#### 帧格式支持
- **标准帧**: 11位 ID，范围 0x000-0x7FF
- **扩展帧**: 29位 ID，范围 0x00000000-0x1FFFFFFF
- 自动调整模板和显示格式
- 智能验证ID值范围

#### 可配置字段系统
- **灵活字段定义**: 自定义字段名称、位数和位置
- **不连续位段**: 支持字段分布在多个不连续位置
- **实时位图显示**: 图形化显示字段分布，高亮冲突区域
- **智能排列**: 一键自动优化字段位置排列

#### 批量字段配置
- **多字段选择**: 任意选择哪些字段参与批量生成
- **独立范围设置**: 每个批量字段都有独立的最小值和最大值配置
- **位数限制验证**: 自动限制输入值不超过字段的最大值（2^位数-1）
- **集中管理**: 统一的批量配置界面，避免配置混淆

#### 多报文管理
- **多报文支持**: 每个通道可配置多个不同功能的报文
- **独立信号定义**: 每个报文独立配置信号参数
- **功能码管理**: 支持不同报文使用不同功能码

#### 智能验证系统
- **实时冲突检测**: 自动检测字段位置冲突
- **范围验证**: 验证输入值是否在有效范围内
- **信号重叠检测**: 检测信号位是否重叠
- **完整性验证**: 确保配置的完整性和正确性

#### DBC文件生成
- **标准格式支持**: 符合Vector CANdb++格式标准
- **实时预览**: 即时查看生成的DBC内容
- **批量导出**: 一键导出所有配置的报文

## 🚀 快速开始

### 方法一：直接打开（推荐）
1. 下载项目文件
2. 双击 `index.html` 文件
3. 在浏览器中开始使用

### 方法二：本地服务器
```bash
# 使用Python启动本地服务器
python -m http.server 8080
# 然后访问 http://localhost:8080
```

### 方法三：使用提供的启动脚本
- **Windows**: 双击 `启动DBC编辑器.bat`
- **PowerShell**: 运行 `启动DBC编辑器.ps1`
- **Python**: 运行 `启动DBC编辑器.py`

## 📖 详细使用说明

### 1. 字段配置管理

#### 基础配置
1. **选择帧格式**: 在页面顶部选择标准帧或扩展帧
2. **加载模板**: 选择预设模板或创建自定义配置
3. **添加字段**: 点击"添加字段"按钮创建新字段

#### 字段属性设置
- **字段名称**: 输入描述性名称（如：通道编号、功能码等）
- **总位数**: 设置字段占用的总位数
- **描述**: 添加字段用途说明
- **位段配置**: 设置字段在ID中的具体位置

#### 位段配置
- **添加段**: 点击"添加段"创建不连续的位段
- **位置设置**: 指定每个段的起始位置和长度
- **自动排列**: 使用"自动排列"功能优化字段布局

### 2. 批量字段配置

#### 配置步骤
1. 在"批量字段配置"区域查看所有字段
2. 勾选需要在批量生成时变化的字段
3. 为每个选中的字段设置取值范围（最小值-最大值）
4. 系统会自动验证范围不超过字段位数限制

#### 配置说明
- **启用字段**: 勾选复选框启用字段的批量生成
- **范围设置**: 设置该字段在批量生成时的变化范围
- **位数限制**: 系统自动限制最大值不超过 2^位数-1
- **视觉反馈**: 启用的字段有蓝色边框，禁用字段变灰

### 3. 报文管理

#### 添加报文
1. 点击"添加报文"按钮
2. 设置报文基本信息：
   - 报文名称
   - 报文长度（1-8字节）
   - 发送节点
   - 功能码
   - 描述信息

#### 信号定义
1. 在报文中点击"添加信号"
2. 配置信号参数：
   - 信号名称和描述
   - 起始位和长度
   - 数据类型（有符号/无符号）
   - 比例因子和偏移量
   - 最小值和最大值
   - 单位信息

### 4. 批量生成

#### 生成步骤
1. 在"批量字段配置"中选择变化字段
2. 设置通道范围（起始-结束编号）
3. 配置命名模式（使用 `{num}` 作为通道号占位符）
4. 点击"生成所有通道报文"

#### 生成逻辑
- 系统为每个通道编号生成一套完整的报文
- 选定的批量字段根据设置的范围自动变化
- 未选择的字段保持固定值
- 支持多个字段同时变化

### 5. 预览和导出

#### 预览功能
- 点击"预览DBC内容"查看生成的DBC格式
- 检查报文ID、信号定义等信息
- 验证格式的正确性

#### 导出功能
- 点击"导出DBC文件"下载完整的DBC文件
- 文件名自动包含时间戳
- 符合Vector CANdb++标准格式

## ⚙️ 配置说明

### 预设模板

#### 扩展帧模板
1. **默认配置**: 板卡类型(4bit) + 通道编号(8bit) + 功能码(4bit) + 板子编号(5bit) + Box编号(3bit)
2. **简单配置**: 通道编号(8bit) + 功能码(8bit) + 设备ID(8bit)
3. **分段示例**: 演示不连续位段的配置方法

#### 标准帧模板
1. **简单配置**: 通道编号(6bit) + 功能码(3bit) + 设备ID(2bit)
2. **详细配置**: 板卡类型(2bit) + 通道编号(5bit) + 功能码(3bit) + Box编号(1bit)

### 字段配置规范

#### 位置分配
- **高位优先**: 重要字段建议放在高位
- **连续分配**: 优先使用连续位段
- **避免冲突**: 系统自动检测并标识冲突

#### 命名规范
- 使用描述性名称
- 避免特殊字符
- 建议使用中文或英文

## 🛠️ 技术特性

### 前端技术
- **纯HTML/CSS/JavaScript实现**
- **无需服务器环境**
- **响应式设计，支持移动端**
- **实时计算和验证**

### 核心算法
- **位图分配算法**: 智能分配字段位置
- **冲突检测算法**: 实时检测位置冲突
- **范围映射算法**: 批量生成时的值映射
- **DBC格式生成**: 标准格式输出

### 数据结构
- **字段配置**: 支持复杂的位段结构
- **报文管理**: 层次化的报文和信号管理
- **模板系统**: 可扩展的配置模板

## 📁 文件结构

```
DBCeditor/
├── index.html              # 主界面文件
├── styles.css              # 样式定义
├── script.js               # 核心逻辑
├── favicon.svg             # 网站图标
├── README.md               # 项目说明
├── 启动DBC编辑器.bat       # Windows启动脚本
├── 启动DBC编辑器.ps1       # PowerShell启动脚本
├── 启动DBC编辑器.py        # Python启动脚本
├── 启动DBC编辑器.vbs       # VBScript启动脚本
└── 创建桌面快捷方式.bat    # 快捷方式创建脚本
```

## 📚 使用示例

### 示例1：简单单通道配置

```
1. 选择"扩展帧"格式
2. 加载"默认配置"模板
3. 在"报文ID数值配置"中设置：
   - 板卡类型: 1
   - 通道编号: 5
   - 功能码: 2
   - 板子编号: 3
   - Box编号: 1
4. 添加信号：
   - 名称: "Temperature"
   - 起始位: 0
   - 长度: 16
   - 比例因子: 0.1
   - 单位: "°C"
5. 导出DBC文件

结果: 报文ID = 0x15261B9
```

### 示例2：多字段批量生成

```
1. 在"批量字段配置"中：
   - 勾选"板卡类型"，设置范围 1-4
   - 勾选"通道编号"，设置范围 0-15
2. 在"批量生成"中：
   - 起始通道: 0
   - 结束通道: 63
   - 命名模式: "Device_{num}_Data"
3. 点击"生成所有通道报文"

结果: 生成64个通道的报文，板卡类型和通道编号按设置范围循环变化
```

### 示例3：不连续位段配置

```
1. 添加字段"通道编号"，总位数8
2. 配置位段：
   - 段1: 位置23，长度3  # 高3位
   - 段2: 位置5，长度5   # 低5位
3. 查看位图可视化确认分布
4. 设置字段值验证正确性

结果: 8位通道编号分布在两个不连续的位段中
```

## ❓ 常见问题

### Q: 如何解决字段冲突？
A: 系统会自动检测冲突并用红色高亮显示。调整字段位置或使用"自动排列"功能可解决冲突。

### Q: 批量生成时字段如何变化？
A: 在"批量字段配置"中勾选的字段会根据设置的范围循环变化，未勾选的字段保持固定值。

### Q: 支持哪些DBC格式？
A: 支持Vector CANdb++标准格式，兼容大多数CAN分析工具。

### Q: 如何保存配置？
A: 使用"保存模板"功能可以保存当前字段配置，下次可通过模板快速加载。

### Q: 位段配置有什么限制？
A: 位段不能重叠，总位数不能超过帧格式限制（标准帧11位，扩展帧29位）。

### Q: 如何创建桌面快捷方式？
A: 运行项目中的"创建桌面快捷方式.bat"文件，会自动在桌面创建启动图标。

## 🌐 浏览器兼容性

| 浏览器 | 版本要求 | 支持状态 |
|--------|----------|----------|
| Chrome | 60+ | ✅ 完全支持 |
| Firefox | 55+ | ✅ 完全支持 |
| Safari | 12+ | ✅ 完全支持 |
| Edge | 79+ | ✅ 完全支持 |
| IE | 11+ | ⚠️ 基本支持 |

## 🤝 贡献指南

我们欢迎所有形式的贡献！

### 如何贡献
1. Fork 本项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建Pull Request

### 报告问题
- 使用Issue模板报告bug
- 提供详细的复现步骤
- 包含浏览器和操作系统信息

### 功能建议
- 在Issue中详细描述建议的功能
- 说明使用场景和预期效果
- 欢迎提供设计草图或原型

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🏷️ 版本历史

### v2.1 (2024-08-28)
- 新增统一的批量字段配置界面
- 支持多字段批量生成
- 增强范围验证和位数限制
- 优化界面布局，修复文字遮挡问题
- 改善用户体验和视觉反馈

### v2.0 (2024-08)
- 添加标准帧和扩展帧支持
- 实现多报文管理功能
- 新增可配置字段系统
- 支持不连续位段配置
- 添加图形化位图显示
- 增强智能验证功能

### v1.0 (2024)
- 基础DBC编辑功能
- 单报文编辑支持
- 基本的批量生成功能

---

<div align="center">

**⭐ 如果这个项目对您有帮助，请给它一个Star！⭐**

[🚀 快速开始](#快速开始) • [📖 使用说明](#详细使用说明) • [🤝 贡献指南](#贡献指南) • [📄 许可证](#许可证)

**Made with ❤️ for the CAN community**

</div>

## 功能特性

### 🆕 新增特性 (v2.0)
- **帧格式切换**: 支持标准帧(11位)和扩展帧(29位)切换
- **多报文管理**: 支持每个通道配置多个不同功能的报文
- **可配置字段系统**: 支持自定义字段数量、大小和位置
- **不连续位段支持**: 字段可分布在多个不连续的位段
- **通道范围独立配置**: 通道范围不受字段位数限制
- **图形化位图显示**: 实时显示字段位置分布，标注高低位
- **智能冲突检测**: 自动检测和高亮显示字段冲突
- **配置模板系统**: 内置多种模板，支持保存自定义配置
- **自动位置排列**: 一键自动优化字段排列

### 🎯 核心功能
- **帧格式支持**: 灵活切换标准帧和扩展帧
  - **标准帧**: 11位 ID，ID范围 0x000-0x7FF
  - **扩展帧**: 29位 ID，ID范围 0x00000000-0x1FFFFFFF
  - 自动调整模板和显示格式
  - 智能验证ID值范围
  
- **多报文管理**: 每个通道支持多个不同功能的报文
  - 数据采集报文、状态报告报文、控制指令报文等
  - 每个报文独立配置功能码、信号定义等
  - 批量生成时自动为每个通道生成所有配置的报文
  
- **灵活的报文ID配置**: 支持任意字段组合
  - 自定义字段名称、位数和位置
  - 支持不连续位段配置（如通道号可分为3bit在高位+5bit在低位）
  - 灵活设置可变字段（批量生成时变化）
  - 独立的通道范围配置（不受字段位数限制）
  - 实时显示位图和冲突检测

- **信号定义**: 完整的CAN信号参数配置
  - 信号名称和描述
  - 起始位和长度
  - 数据类型（有符号/无符号）
  - 比例因子和偏移量
  - 最小值和最大值
  - 单位信息

- **批量生成**: 一键生成多通道报文
  - 指定通道范围
  - 自动计算报文ID
  - 支持命名模式替换
  - 智能验证重叠检测

- **DBC导出**: 符合标准的DBC文件生成
  - 完整的DBC格式支持
  - 实时预览功能
  - 一键下载导出

### 🛠️ 技术特性
- 纯前端实现，无需服务器
- 响应式设计，支持移动端
- 实时验证和错误提示
- 直观的可视化界面

## 使用方法

### 1. 启动工具
直接用浏览器打开 `index.html` 文件即可使用。

### 2. 配置报文ID
在"报文ID配置"区域设置各个字段的值：
- **通道类型**: 设备通道的类型标识
- **通道编号**: 当前编辑的通道编号（批量生成时会自动变化）
- **功能码**: 报文的功能代码
- **板子编号**: 硬件板卡编号
- **Box编号**: 设备盒编号

系统会实时显示当前的报文ID（十六进制和二进制格式）。

### 3. 编辑报文内容
- 设置报文名称、长度和发送节点
- 添加信号定义：
  - 点击"添加信号"按钮
  - 配置信号的各项参数
  - 系统会自动验证位重叠等错误

### 4. 批量生成
在"批量生成"区域：
- 设置起始和结束通道编号
- 配置命名模式（使用 `{num}` 作为通道编号占位符）
- 点击"生成所有通道报文"

### 5. 导出DBC文件
- 点击"预览DBC内容"查看生成的DBC格式
- 点击"导出DBC文件"下载文件

## 文件结构

```
DBCeditor/
├── index.html          # 主页面
├── styles.css          # 样式文件
├── script.js           # 主要逻辑
└── README.md           # 说明文档
```

## 报文ID格式

工具采用29位扩展CAN ID格式，字段分布如下：

```
位位置: 23-20 | 19-12    | 11-8   | 7-3      | 2-0
字段:   通道类型| 通道编号  | 功能码  | 板子编号  | Box编号
位数:   4bit   | 8bit     | 4bit   | 5bit     | 3bit
```

## 使用示例

### 示例1：单通道配置
1. 设置通道类型=1, 通道编号=5, 功能码=2, 板子编号=3, Box编号=1
2. 报文ID将生成为: 0x152619 (二进制: 000101010010011000011001)
3. 添加信号，如："Speed", 起始位0, 长度16, 比例因子0.1
4. 点击导出获得DBC文件

### 示例2：批量生成多通道
1. 配置基础参数（通道编号除外）
2. 设置通道范围: 0-7
3. 命名模式: "Channel_{num}_Data"
4. 生成8个通道的报文，通道编号从0到7自动递增

## 注意事项

- 确保信号位不重叠，系统会自动检测并提示
- 信号的起始位+长度不能超过报文长度
- 批量生成时建议通道数量不超过100个
- 导出的DBC文件符合Vector CANdb++格式标准

## 浏览器兼容性

- Chrome/Edge: 完全支持
- Firefox: 完全支持  
- Safari: 完全支持
- IE11+: 基本支持

## 技术支持

如有问题或建议，请通过以下方式联系：
- 提交Issue到项目仓库
- 发送邮件至技术支持

---

© 2024 DBC编辑器. 保留所有权利.