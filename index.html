<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBC文件编辑器</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>DBC文件编辑器</h1>
            <p>多通道CAN报文批量生成工具</p>
        </header>

        <main>
            <!-- 字段配置管理区域 -->
            <section class="field-config-section">
                <h2>字段配置管理</h2>
                <div class="config-controls">
                    <div class="frame-format-controls">
                        <label for="frameFormat">帧格式:</label>
                        <select id="frameFormat">
                            <option value="extended">扩展帧 (29位)</option>
                            <option value="standard">标准帧 (11位)</option>
                        </select>
                        <span class="frame-info" id="frameInfo">ID范围: 0x00000000 - 0x1FFFFFFF</span>
                    </div>
                    <div class="template-controls">
                        <label for="configTemplate">配置模板:</label>
                        <select id="configTemplate">
                            <option value="default">默认配置</option>
                            <option value="simple">简单配置</option>
                            <option value="split_channel">分段示例</option>
                        </select>
                        <button type="button" id="loadTemplateBtn" class="btn-secondary">加载模板</button>
                        <button type="button" id="saveTemplateBtn" class="btn-secondary">保存模板</button>
                    </div>
                    <div class="field-controls">
                        <button type="button" id="addFieldBtn" class="btn-primary">添加字段</button>
                        <button type="button" id="autoArrangeBtn" class="btn-secondary">自动排列</button>
                        <span class="total-bits-info">总位数: <span id="totalBitsDisplay">24</span> / <span id="maxBitsDisplay">29</span></span>
                    </div>
                </div>
                
                <!-- 字段列表 -->
                <div class="fields-container">
                    <h3>字段定义</h3>
                    <div id="fieldsContainer">
                        <!-- 字段会动态添加到这里 -->
                    </div>
                </div>
                
                <!-- 位图可视化 -->
                <div class="bitmap-visualization">
                    <h3>位图可视化</h3>
                    <div class="bitmap-container">
                        <div class="bit-scale">
                            <!-- 位置标尺 -->
                        </div>
                        <div class="bit-display" id="bitDisplay">
                            <!-- 位图显示 -->
                        </div>
                        <div class="bit-labels">
                            <!-- 位标签 -->
                        </div>
                    </div>
                    <div class="bitmap-legend">
                        <span class="legend-item"><span class="color-box used"></span>已使用</span>
                        <span class="legend-item"><span class="color-box unused"></span>未使用</span>
                        <span class="legend-item"><span class="color-box conflict"></span>冲突</span>
                        <div id="fieldColorLegend" class="field-color-legend">
                            <!-- 动态生成的字段颜色图例 -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- 多报文管理区域 -->
            <section class="message-section">
                <h2>报文管理</h2>
                <div class="message-controls">
                    <button type="button" id="addMessageBtn" class="btn-primary">添加报文</button>
                    <span class="message-count-info">已配置报文: <span id="messageCountDisplay">1</span> 个</span>
                </div>
                
                <!-- 报文列表 -->
                <div class="messages-container">
                    <div id="messagesContainer">
                        <!-- 报文会动态添加到这里 -->
                    </div>
                </div>
                
                <!-- 当前选中报文的位图可视化 -->
                <div class="message-bitmap-section" id="messageBitmapSection" style="display: none;">
                    <h3>信号位图可视化</h3>
                    <div class="message-bitmap-info">
                        <p>当前报文: <span id="currentMessageName">未选择</span> | 报文长度: <span id="currentMessageLength">8</span> 字节 (<span id="currentMessageBits">64</span>位)</p>
                    </div>
                    <div class="message-bitmap-container">
                        <div class="message-bit-scale">
                            <!-- 位置标尺 -->
                        </div>
                        <div class="message-bit-display" id="messageBitDisplay">
                            <!-- 位图显示 -->
                        </div>
                        <div class="message-bit-labels">
                            <!-- 位标签 -->
                        </div>
                    </div>
                    <div class="message-bitmap-legend">
                        <span class="legend-item"><span class="color-box used"></span>已使用</span>
                        <span class="legend-item"><span class="color-box unused"></span>未使用</span>
                        <span class="legend-item"><span class="color-box conflict"></span>冲突</span>
                        <span class="legend-item"><span class="color-box lsb-first"></span>LSB优先(Intel)</span>
                        <span class="legend-item"><span class="color-box msb-first"></span>MSB优先(Motorola)</span>
                        <div id="messageSignalColorLegend" class="signal-color-legend">
                            <!-- 动态生成的信号颜色图例 -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- 批量生成区域 -->
            <section class="batch-section">
                <h2>批量生成</h2>
                
                <!-- 批量字段配置 -->
                <div class="batch-fields-config">
                    <h3>批量字段配置</h3>
                    <p style="color: #666; margin-bottom: 15px;">选择哪些字段在批量生成时会变化，并设置它们的取值范围。未勾选的字段可以直接设置固定值。</p>
                    
                    <!-- 实时ID预览 -->
                    <div class="id-preview-section">
                        <div class="id-preview">
                            <strong>当前配置的报文ID: </strong>
                            <span id="messageIdPreview">0x000</span>
                            <span class="id-binary" id="binaryPreview">(二进制: 000000000000000000000000)</span>
                        </div>
                        <div class="id-preview-note">
                            <small>ℹ️ 此ID使用下方设置的固定值和当前选中报文的功能码计算得出</small>
                        </div>
                    </div>
                    
                    <div id="batchFieldsContainer">
                        <!-- 动态生成的批量字段配置 -->
                    </div>
                </div>
                
                <div class="batch-config">
                    <!-- 报文命名模式配置 -->
                    <div class="message-naming-config">
                        <h4>报文命名模式配置</h4>
                        <p style="color: #666; margin-bottom: 15px;">为每个报文配置独立的批量生成命名模式。支持占位符 {num} 和字段缩写。</p>
                        <div id="messageNamingContainer">
                            <!-- 动态生成的报文命名模式配置 -->
                        </div>
                    </div>
                    
                    <!-- 全局命名模式（作为后备）-->
                    <div class="field-group" style="margin-top: 20px;">
                        <label for="namingPattern">全局命名模式（后备）:</label>
                        <input type="text" id="namingPattern" placeholder="例如: CH{CH}_FC{FC}_Data_{num}" value="Channel_{num}_Data">
                        <div class="naming-pattern-help">
                            <div class="pattern-examples">
                                <strong>占位符说明:</strong>
                                <ul>
                                    <li><code>{num}</code> - 消息序号 (0, 1, 2...)</li>
                                    <li><code>{num:03d}</code> - 3位前导零格式 (000, 001, 002...)</li>
                                    <li><code>{num:prefix_:05d:_suffix}</code> - 自定义前后缀 (prefix_00000_suffix, prefix_00001_suffix...)</li>
                                    <li id="fieldPlaceholdersList">
                                        <!-- 动态生成的字段占位符列表 -->
                                    </li>
                                </ul>
                            </div>
                            <div class="pattern-examples-section">
                                <strong>示例模式:</strong>
                                <ul>
                                    <li><code>Channel_{num}_Data</code> → Channel_0_Data, Channel_1_Data...</li>
                                    <li><code>Sensor_{CH:03d}_Data</code> → Sensor_009_Data, Sensor_010_Data...</li>
                                    <li><code>{CH:ID_:04d:_MSG}</code> → ID_0009_MSG, ID_0010_MSG...</li>
                                    <li><code>CH{CH}_FC{FC}</code> → CH0_FC1, CH1_FC2... (需要相应字段)</li>
                                </ul>
                                <div class="format-help" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; border-left: 3px solid #17a2b8;">
                                    <strong>数字格式化说明:</strong>
                                    <ul style="margin: 5px 0 0 20px; font-size: 0.9em;">
                                        <li><code>03d</code> - 3位前导零: 009, 010, 011</li>
                                        <li><code>d0</code> - 1位后导零: 90, 100, 110</li>
                                        <li><code>5d2</code> - 5位前导零+2位后导零: 0009000, 0010000</li>
                                        <li><code>ABC_:04d:_DEF</code> - 前缀+4位前导零+后缀: ABC_0009_DEF</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="pattern-validation" id="patternValidation" style="margin-top: 10px; display: none;">
                                <!-- 动态显示验证结果 -->
                            </div>
                        </div>
                    </div>
                    <div class="batch-preview" id="batchPreview">
                        <h4>生成预览</h4>
                        <p id="batchPreviewText">请先配置批量字段以查看生成预览</p>
                    </div>
                    <div class="batch-info">
                        <p style="color: #666; font-size: 0.9em; margin: 10px 0;">
                            💡 <strong>生成说明</strong>: 系统将根据勾选的批量字段及其范围的所有组合生成报文。例如：板卡类型(3~5) × 通道编号(1~8) = 24条报文。
                        </p>
                    </div>
                </div>
                <button type="button" id="generateBtn" class="btn-success">生成所有通道报文</button>
            </section>

            <!-- 预览和导出区域 -->
            <section class="export-section">
                <h2>预览与导出</h2>
                <div class="preview-controls">
                    <button type="button" id="previewBtn" class="btn-secondary">预览DBC内容</button>
                    <button type="button" id="exportBtn" class="btn-success">导出DBC文件</button>
                </div>
                <div class="preview-area">
                    <textarea id="dbcPreview" readonly placeholder="DBC文件内容将显示在这里..."></textarea>
                </div>
            </section>
        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>